# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  owner: owner.yml

types:

  TokenId: string

  CreateTokenResponse:
    properties:
      token: string
      tokenId: TokenId

  TokenMetadata:
    properties:
      tokenId: TokenId
      ownerId: owner.OwnerId
      description: optional<string>
      createdTime: datetime
      status: TokenStatus

  TokenStatus:
    union:
      active: {}
      expired: {}
      revoked: {}

services:
  http:

    TokenService:
      auth: false
      base-path: /tokens
      endpoints:

        create:
          method: POST
          path: /create
          request:
            name: CreateTokenRequest
            body:
              properties:
                ownerId: owner.OwnerId
                description: optional<string>
          response: CreateTokenResponse
          errors:
            - owner.OwnerNotFoundError
          examples:
            - request:
                ownerId: some-owner-id
              response:
                body:
                  token: token-value
                  tokenId: token-id
            - request:
                ownerId: missing-owner-id
              response:
                error: owner.OwnerNotFoundError

        getTokenMetadata:
          method: POST
          path: /metadata
          request:
            name: GetTokenMetadataRequest
            body:
              properties:
                token: string
          response: TokenMetadata
          errors:
            - TokenNotFoundError
          examples:
            - request:
                token: token-value
              response:
                body:
                  tokenId: token-id
                  ownerId: some-owner-id
                  createdTime: "2022-12-23T10:43:35Z"
                  status:
                    type: active
            - request:
                token: missing-token-value
              response:
                error: TokenNotFoundError


        # add paging
        getTokensForOwner:
          method: GET
          path: /owner/{ownerId}
          path-parameters:
            ownerId: owner.OwnerId
          response: list<TokenMetadata>
          errors:
            - owner.OwnerNotFoundError
          examples:
            - path-parameters:
                ownerId: some-owner-id
              response:
                body:
                  - tokenId: token-id
                    ownerId: some-owner-id
                    createdTime: "2022-12-23T10:43:35Z"
                    status:
                      type: active
            - path-parameters:
                ownerId: missing-owner-id
              response:
                error: owner.OwnerNotFoundError

        revokeTokenById:
          method: POST
          path: /revoke/{tokenId}
          path-parameters:
            tokenId: TokenId
          errors:
            - TokenNotFoundError
          examples:
            - path-parameters:
                tokenId: some-token-id
            - path-parameters:
                tokenId: missing-token-id
              response:
                error: TokenNotFoundError

        revokeToken:
          method: POST
          path: /revoke
          request:
            name: RevokeTokenRequest
            body:
              properties:
                token: string
          errors:
            - TokenNotFoundError
          examples:
            - request:
                token: some-token-value
            - request:
                token: missing-token-value
              response:
                error: TokenNotFoundError

errors:
  TokenNotFoundError:
    status-code: 404
